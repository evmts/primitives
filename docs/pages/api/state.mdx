---
title: State Management
description: Database API for accounts, storage, code, and snapshots
---

# State Management

Guillotine uses an in-memory `Database` by default. You pass a pointer to this database when initializing the EVM, and interact with it directly to manage accounts, storage, and code.

```zig
const g = @import("guillotine");
var db = g.Database.init(allocator);
defer db.deinit();
```

## Accounts

```zig
// Read account
const maybe = try db.get_account(address.bytes);    // ?Account

// Write account
var acc = g.Account.zero();
acc.balance = 1_000_000_000_000_000_000; // 1 ETH
try db.set_account(address.bytes, acc);

// Delete account (and associated data)
try db.delete_account(address.bytes);

// Existence and balance
const exists = db.account_exists(address.bytes);
const balance = try db.get_balance(address.bytes);  // u256
```

## Storage

```zig
// Read storage slot
const value = try db.get_storage(contract.bytes, key);

// Write storage slot
try db.set_storage(contract.bytes, key, value);

// Transient storage (EIP-1153)
const t = try db.get_transient_storage(contract.bytes, key);
try db.set_transient_storage(contract.bytes, key, t + 1);
```

## Code

```zig
// Install code and keep the hash
const code_hash = try db.set_code(&bytecode);

// Attach code to an account
var acc = g.Account.zero();
acc.code_hash = code_hash;
try db.set_account(contract.bytes, acc);

// Load code
const code_by_hash = try db.get_code(code_hash);
const code_by_addr = try db.get_code_by_address(contract.bytes);
```

## Snapshots and commits

```zig
// Create a snapshot before running a transaction
const id = try db.create_snapshot();

// ... make changes ...

// Revert to snapshot on failure
try db.revert_to_snapshot(id);

// Or commit snapshot on success
try db.commit_snapshot(id);

// Commit batch changes / get state root (mocked)
const root = try db.commit_changes();
```

## Notes

- The default `Database` is an in-memory implementation optimized for testing and integration
- `get_code_by_address` resolves EIP-7702 delegated code if present
- For production, persist state outside the EVM and hydrate this database as needed

