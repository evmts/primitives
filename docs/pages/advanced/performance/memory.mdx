---
title: Memory Management
description: Patterns for safe, efficient memory use with Guillotine
---

# Memory Management

Guillotine follows explicit ownership and clean deinit patterns. This page outlines practical patterns that align with the projectâ€™s standards.

## Allocator setup

```zig
var gpa = std.heap.GeneralPurposeAllocator(.{}){};
defer _ = gpa.deinit();
const allocator = gpa.allocator();
```

## EVM lifecycle

```zig
const Evm = g.Evm(g.EvmConfig{});
var evm = try Evm.init(allocator, &db, block, tx, 0, origin, hardfork);
defer evm.deinit();
```

`defer evm.deinit()` releases internal buffers, logs, and arenas. Callers own `result.output` slices and should copy or consume them before the EVM is dropped.

## Database ownership

The in-memory `Database` owns code slices returned by `get_code`/`get_code_by_address`. Callers should not free them; the database frees code on `db.deinit()`.

## Patterns

- Same-scope allocation and free via `defer`
- Ownership transfer via `errdefer` and explicit `deinit`
- Avoid storing long-lived references to transient data returned by the EVM; copy if needed

These mirror the guidelines in the contributor docs and the style used in unit tests across the codebase.

