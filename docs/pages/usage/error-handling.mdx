---
title: Error Handling
description: Handle call results and failures correctly
---

# Error Handling

`Evm.call` and `Evm.simulate` return a `CallResult` value (not an error union). Internal execution errors are mapped into a failure result so your control flow remains simple.

## CallResult at a glance

- success: bool — whether execution succeeded
- gas_left: u64 — gas remaining
- output: []const u8 — return data or revert data
- created_address: ?Address — set for CREATE/CREATE2 on success
- logs, selfdestructs, accessed_* — introspection data

## Basic handling

```zig
const result = evm.call(params);
if (!result.success) {
  // Optional: decode revert reason from result.output
  return;
}
// Use result.output on success
```

## Distinguishing reverts

Reverts are reported as `success=false` with ABI-encoded revert data in `output` when applicable.

```zig
if (!result.success and result.output.len >= 4) {
  const selector = result.output[0..4];
  // 0x08c379a0 = Error(string)
  if (std.mem.eql(u8, selector, &[_]u8{0x08,0xC3,0x79,0xA0})) {
    // decode string in result.output[4..]
  }
}
```

## Gas accounting

```zig
const initial = params.getGas();
const used = if (result.gas_left <= initial) initial - result.gas_left else 0;
```

## Simulations (no state changes)

Use `simulate` to preview results without committing state changes:

```zig
const preview = evm.simulate(params);
```

## When do Zig errors bubble up?

Most execution issues are mapped into `CallResult`. Zig errors can still occur when you interact with your allocator or database (e.g., `db.set_code`, memory allocations). Handle those at the call site with `try`/`catch`.

## Retry pattern

```zig
fn executeWithRetry(evm: *Evm, params: Evm.CallParams) void {
  var attempts: u32 = 0;
  while (attempts < 3) : (attempts += 1) {
    const result = evm.call(params);
    if (result.success) return;
    std.time.sleep(100 * std.time.ns_per_ms);
  }
}
```

## Best Practices

- Check `success` and `gas_left` for basic triage
- Decode revert selectors when present
- Use `simulate` for previews and gas estimates
- Keep allocator/database errors local with `try`
- Log structured diagnostics in your application

## Next Steps

- [Basic Execution](/usage/basic-execution)
- [Configuration](/usage/configuration)
- [API Reference](#TODO)

