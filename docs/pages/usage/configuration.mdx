---
title: Configuration
description: Configure Guillotine and initialize the EVM correctly
---

# Configuration

Guillotine works out of the box with sensible defaults and exposes a small set of compile-time options via `EvmConfig`.

## Quick Configuration

### Default Configuration

The default config targets the latest hardfork and sensible limits:

```zig
const g = @import("guillotine");
const config = g.EvmConfig{};
const Evm = g.Evm(config);
```

### Common Configurations

:::code-group

```zig [Production]
const config = g.EvmConfig{ .eips = .{ .hardfork = .CANCUN } };
const Evm = g.Evm(config);
```

```zig [Testing]
const config = g.EvmConfig{ .max_call_depth = 100, .enable_precompiles = false };
const Evm = g.Evm(config);
```

```zig [Minimal]
const config = g.EvmConfig{ .enable_precompiles = false, .enable_fusion = false, .stack_size = 256 };
const Evm = g.Evm(config);
```

:::

## Basic Options

### Hardfork Selection

Choose the Ethereum hardfork to use:

```zig
const config = g.EvmConfig{ .eips = .{ .hardfork = .CANCUN } }; // default
```

| Hardfork | Features | Use Case |
|----------|----------|----------|
| `CANCUN` | Latest features, blob transactions | Production mainnet |
| `SHANGHAI` | Withdrawals, PUSH0 | Most testnets |
| `LONDON` | EIP-1559, base fee | Legacy support |
| `BERLIN` | Access lists | Older contracts |

### Feature Toggles

Enable or disable features:

```zig
const config = g.EvmConfig{ .enable_precompiles = true, .enable_fusion = true };
```

### Resource Limits

Set execution limits:

```zig
const config = g.EvmConfig{
  .max_call_depth = 1024,
  .max_input_size = 131072,
  .block_gas_limit = 30_000_000,
};
```

## Memory Configuration

### Stack Size

```zig
const config = g.EvmConfig{ .stack_size = 1024 };
```

### Memory Limits

```zig
const config = g.EvmConfig{ .memory_initial_capacity = 4096, .memory_limit = 0xFFFFFF };
```

## Build Modes

Choose the right build mode for your use case:

```bash
# Development - full debugging
zig build -Doptimize=Debug

# Production - with safety checks (recommended)
zig build -Doptimize=ReleaseSafe

# Maximum performance
zig build -Doptimize=ReleaseFast

# Minimum size
zig build -Doptimize=ReleaseSmall
```

| Mode | Debug Info | Safety Checks | Speed | Size | Use Case |
|------|------------|---------------|-------|------|----------|
| Debug | ✅ Full | ✅ All | ❌ Slow | ❌ Large | Development |
| ReleaseSafe | ⚠️ Limited | ✅ Runtime | ✅ Fast | ⚠️ Medium | **Production** |
| ReleaseFast | ❌ None | ❌ None | ✅ Fastest | ⚠️ Medium | Benchmarking |
| ReleaseSmall | ❌ None | ❌ None | ✅ Fast | ✅ Smallest | Embedded |

## Initialization (context and state)

`Evm.init` requires a database and context values:

```zig
var db = g.Database.init(allocator);
defer db.deinit();

var block = g.BlockInfo.init();
const tx = g.TransactionContext{ .gas_limit = 1_000_000, .coinbase = g.Primitives.ZERO_ADDRESS, .chain_id = 1 };
const origin = g.Primitives.ZERO_ADDRESS;
var evm = try Evm.init(allocator, &db, block, tx, /*gas_price=*/0, origin, config.eips.hardfork);
defer evm.deinit();
```

> Note: Some advanced fields (like tracing types) exist in `EvmConfig` for internal modules. External tracing and custom database types are not part of the stable public API yet.

## Configuration Examples

### For dApps

```zig
const config = g.EvmConfig{ .eips = .{ .hardfork = .CANCUN }, .enable_precompiles = true, .enable_fusion = true, .max_input_size = 65536 };
const Evm = g.Evm(config);
```

### For Testing

```zig
const config = g.EvmConfig{ .enable_precompiles = false, .max_call_depth = 10, .stack_size = 256 };
const Evm = g.Evm(config);
```

### For Embedded Systems

```zig
const config = g.EvmConfig{ .stack_size = 256, .memory_initial_capacity = 1024, .memory_limit = 65536, .max_call_depth = 5, .enable_fusion = false };
const Evm = g.Evm(config);
```

## Build Modes

Choose the right build mode (Guillotine recommendation):

```bash
zig build -Doptimize=ReleaseSafe   # recommended
zig build test                     # verify
```

```bash
# Set log level
export GUILLOTINE_LOG_LEVEL=debug

# Enable tracing
export GUILLOTINE_TRACE=1

# Set memory limit
export GUILLOTINE_MEM_LIMIT=16777216
```

## Configuration Validation

Guillotine validates configuration at compile time:

```zig
// This will fail at compile time
const Evm = guillotine.Evm(.{
    .max_call_depth = 100000, // Error: exceeds u11 max
});
```

## Performance Impact

| Setting | Impact | Notes |
|---------|--------|-------|
| `enable_fusion` | +10-15% speed | Fuses common opcode patterns |
| `enable_precompiles` | Minimal | Only affects precompile calls |
| `stack_size` | Memory usage | Larger = more memory |
| `TracerType` | -20-30% speed | Significant overhead |
| Build mode | Varies | ReleaseFast is 2-3x faster than Debug |

## Best Practices

:::tip[Configuration Tips]
1. **Start with defaults** - Only configure what you need
2. **Use ReleaseSafe for production** - Balance of safety and speed
3. **Disable unused features** - Reduce binary size
4. **Test configuration changes** - Measure performance impact
5. **Document custom configs** - Help future maintainers
:::

## Advanced Configuration

For advanced configuration options, see:

:::info[Advanced Topics]
- [Compile-time Configuration](/advanced/customization/comptime-config)
- [Custom Hardforks](/advanced/customization/hardforks)
- [Custom Opcodes](/advanced/customization/opcodes)
- [Performance Tuning](/advanced/performance/optimization)
:::

## Configuration Reference

### Complete EvmConfig

```zig
pub const EvmConfig = struct {
    // Hardfork selection
    eips: Eips = .{ .hardfork = .CANCUN },
    
    // Execution limits
    max_call_depth: u11 = 1024,
    max_input_size: u18 = 131072,
    
    // Features
    enable_precompiles: bool = true,
    enable_fusion: bool = true,
    
    // Stack and memory
    stack_size: u12 = 1024,
    WordType: type = u256,
    memory_initial_capacity: usize = 4096,
    memory_limit: u64 = 0xFFFFFF,
    
    // Code limits
    max_bytecode_size: u32 = 24576,
    max_initcode_size: u32 = 49152,
    
    // Gas
    block_gas_limit: u64 = 30_000_000,
    
    // Storage
    DatabaseType: type = Database,
    
    // Debugging
    TracerType: ?type = null,
};
```

## Next Steps

- **[Error Handling](/usage/error-handling)** - Handle errors gracefully
- **[Basic Execution](/usage/basic-execution)** - Execute EVM bytecode
- **[API Reference](/api/evm)** - Complete API documentation
