---
title: Bun SDK
description: High-performance FFI bindings for Bun runtime
---

import { Callout } from 'vocs/components'

# Bun SDK

High-performance EVM implementation for Bun using FFI bindings to the Guillotine Zig EVM.

<Callout type="warning">
**Experimental/PoC**: This SDK is a vibecoded proof-of-concept. APIs are unstable and may change. We're looking for early users to try it and tell us what APIs you want.

- **Maturity**: Experimental proof-of-concept
- **API stability**: Unstable; breaking changes expected
- **Feedback**: [GitHub Issues](https://github.com/evmts/Guillotine/issues) or [Telegram](https://t.me/+ANThR9bHDLAwMjUx)
</Callout>

## Features

- **Native Performance**: Direct FFI bindings to Zig implementation
- **Type Safety**: Full TypeScript support with strict typing
- **Zero-copy Operations**: Minimal overhead between JavaScript and native code
- **Bun Optimized**: Leverages Bun's fast FFI implementation
- **Simple API**: Clean, intuitive interface for EVM operations

## Installation

::::steps
### Install from npm

```bash
bun add @guillotine/bun
```

### Or build from source

```bash
# Clone repository
git clone https://github.com/evmts/Guillotine.git
cd Guillotine/sdks/bun

# Build shared library
cd ../..
zig build shared -Doptimize=ReleaseFast

# Build TypeScript bindings
cd sdks/bun
bun build src/index.ts --outdir dist --target bun
```
::::

## Quick Start

### Basic Example

```typescript filename="example.ts" showLineNumbers
import { createEVM, CallType, hexToBytes, bytesToHex } from "@guillotine/bun";

// Create EVM instance
const evm = createEVM({
  number: 1n,
  timestamp: BigInt(Date.now()),
  gasLimit: 30_000_000n,
  coinbase: "0x0000000000000000000000000000000000000000",
  baseFee: 1_000_000_000n,
  chainId: 1n,
});

// Set up accounts
const sender = "0x1234567890123456789012345678901234567890";
const receiver = "0x0987654321098765432109876543210987654321";

evm.setBalance(sender, 10n ** 18n); // 1 ETH

// Deploy a simple contract that returns 42
const bytecode = hexToBytes("0x602a60005260206000f3");
evm.setCode(receiver, bytecode);

// Execute contract call
const result = evm.call({
  caller: sender,
  to: receiver,
  value: 0n,
  input: new Uint8Array(),
  gas: 100_000n,
  callType: CallType.CALL,
});

if (result.success) {
  console.log("Success! Gas left:", result.gasLeft);
  console.log("Output:", bytesToHex(result.output));
} else {
  console.log("Failed with error:", result.error);
}

// Clean up
evm.destroy();
```

### Contract Deployment

```typescript filename="deploy.ts"
// Deploy a new contract
const deployResult = evm.call({
  caller: sender,
  to: "0x0000000000000000000000000000000000000000", // Zero address for CREATE
  value: 0n,
  input: contractBytecode,
  gas: 1_000_000n,
  callType: CallType.CREATE,
});

if (deployResult.success) {
  const contractAddress = deployResult.createdAddress;
  console.log("Contract deployed at:", contractAddress);
}
```

## API Reference

### createEVM

Creates a new EVM instance with the specified block configuration.

```typescript
function createEVM(blockInfo: BlockInfo): GuillotineEVM
```

#### BlockInfo

| Field | Type | Description |
|-------|------|-------------|
| `number` | `bigint` | Block number |
| `timestamp` | `bigint` | Block timestamp |
| `gasLimit` | `bigint` | Block gas limit |
| `coinbase` | `string` | Miner address |
| `baseFee` | `bigint` | EIP-1559 base fee |
| `chainId` | `bigint` | Chain identifier |
| `difficulty?` | `bigint` | Block difficulty (pre-merge) |
| `prevRandao?` | `Uint8Array` | Previous RANDAO value (post-merge) |

### GuillotineEVM Methods

:::code-group

```typescript [State Management]
// Set account balance
evm.setBalance(address: string, balance: bigint): void

// Set contract code
evm.setCode(address: string, code: Uint8Array): void

// Get account balance
const balance = evm.getBalance(address: string): bigint

// Get account nonce
const nonce = evm.getNonce(address: string): bigint
```

```typescript [Execution]
// Execute EVM call
const result = evm.call(params: CallParams): EvmResult

// Simulate call without state changes
const simulation = evm.simulate(params: CallParams): EvmResult
```

```typescript [Cleanup]
// Destroy EVM instance and free memory
evm.destroy(): void
```

:::

### CallParams

Parameters for executing EVM calls.

```typescript
interface CallParams {
  caller: string;         // Caller address
  to: string;            // Target address (0x0 for CREATE)
  value: bigint;         // Wei to transfer
  input: Uint8Array;     // Call data
  gas: bigint;           // Gas limit
  callType: CallType;    // Type of call
  salt?: bigint;         // Salt for CREATE2
}
```

### CallType Enum

```typescript
enum CallType {
  CALL = 0,         // Regular call
  DELEGATECALL = 1, // Delegate call
  STATICCALL = 2,   // Static call (read-only)
  CREATE = 3,       // Create contract
  CREATE2 = 4,      // Create with deterministic address
}
```

### EvmResult

```typescript
interface EvmResult {
  success: boolean;      // Execution success
  gasLeft: bigint;       // Remaining gas
  output: Uint8Array;    // Return data
  error?: string;        // Error message if failed
  createdAddress?: string; // For CREATE/CREATE2
  logs?: Log[];          // Emitted logs
}
```

## Advanced Usage

### Working with ABI

```typescript filename="abi.ts"
import { encodeAbiParameters, decodeAbiParameters } from "viem";

// Encode function call
const transferSig = "0xa9059cbb"; // transfer(address,uint256)
const calldata = hexToBytes(
  transferSig +
  encodeAbiParameters(
    [
      { name: "to", type: "address" },
      { name: "amount", type: "uint256" },
    ],
    ["0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb", 1000000000000000000n]
  ).slice(2)
);

// Execute the call
const result = evm.call({
  caller: sender,
  to: tokenContract,
  value: 0n,
  input: calldata,
  gas: 100_000n,
  callType: CallType.CALL,
});

// Decode return value
if (result.success) {
  const [success] = decodeAbiParameters(
    [{ type: "bool" }],
    bytesToHex(result.output)
  );
  console.log("Transfer successful:", success);
}
```

### Error Handling

```typescript filename="errors.ts"
try {
  const result = evm.call(params);
  
  if (!result.success) {
    // Check for specific errors
    if (result.error?.includes("OutOfGas")) {
      console.error("Transaction ran out of gas");
    } else if (result.error?.includes("Revert")) {
      // Decode revert reason
      const reason = decodeRevertReason(result.output);
      console.error("Transaction reverted:", reason);
    } else {
      console.error("Transaction failed:", result.error);
    }
  }
} catch (error) {
  // Handle FFI errors
  console.error("EVM error:", error);
}
```

### Batch Operations

```typescript filename="batch.ts"
// Perform multiple operations efficiently
const operations = [
  { type: "setBalance", address: addr1, value: 1000n },
  { type: "setBalance", address: addr2, value: 2000n },
  { type: "setCode", address: contract1, code: bytecode1 },
  { type: "setCode", address: contract2, code: bytecode2 },
];

for (const op of operations) {
  switch (op.type) {
    case "setBalance":
      evm.setBalance(op.address, op.value);
      break;
    case "setCode":
      evm.setCode(op.address, op.code);
      break;
  }
}

// Execute multiple calls
const results = calls.map(call => evm.call(call));
```

## Performance Tips

<div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1rem', marginBottom: '2rem' }}>
  <div style={{
    padding: '1rem',
    background: 'var(--vocs-color_background2)',
    border: '1px solid var(--vocs-color_border)',
    borderRadius: '8px'
  }}>
    <h4 style={{ marginTop: 0, color: '#10B981' }}>✅ Do</h4>
    <ul style={{ margin: 0 }}>
      <li>Reuse EVM instances</li>
      <li>Use <code>simulate()</code> for dry runs</li>
      <li>Batch state operations</li>
      <li>Clean up with <code>destroy()</code></li>
    </ul>
  </div>
  
  <div style={{
    padding: '1rem',
    background: 'var(--vocs-color_background2)',
    border: '1px solid var(--vocs-color_border)',
    borderRadius: '8px'
  }}>
    <h4 style={{ marginTop: 0, color: '#EF4444' }}>❌ Don't</h4>
    <ul style={{ margin: 0 }}>
      <li>Create EVMs per call</li>
      <li>Forget to destroy instances</li>
      <li>Use excessive gas limits</li>
      <li>Mix sync/async unnecessarily</li>
    </ul>
  </div>
</div>

## Testing

Run the test suite:

```bash
# Run all tests
bun test

# Run specific test file
bun test working.test.ts

# Run with coverage
bun test --coverage
```

### Example Test

```typescript filename="evm.test.ts"
import { describe, it, expect } from "bun:test";
import { createEVM, CallType } from "@guillotine/bun";

describe("EVM", () => {
  it("should execute simple addition", () => {
    const evm = createEVM({
      number: 1n,
      timestamp: 1n,
      gasLimit: 30_000_000n,
      coinbase: "0x" + "00".repeat(20),
      baseFee: 1n,
      chainId: 1n,
    });

    // PUSH1 5, PUSH1 10, ADD
    const bytecode = new Uint8Array([0x60, 0x05, 0x60, 0x0a, 0x01]);
    
    const result = evm.call({
      caller: "0x" + "11".repeat(20),
      to: "0x" + "22".repeat(20),
      value: 0n,
      input: bytecode,
      gas: 100_000n,
      callType: CallType.CALL,
    });

    expect(result.success).toBe(true);
    expect(result.gasLeft).toBeGreaterThan(0n);
    
    evm.destroy();
  });
});
```

## Troubleshooting

:::details[Cannot find module '@guillotine/bun']
**Solution**: Ensure the shared library is built:
```bash
cd ../.. && zig build shared -Doptimize=ReleaseFast
```
:::

:::details[Segmentation fault on EVM operations]
**Solution**: Always initialize EVM before use and destroy after:
```typescript
const evm = createEVM(blockInfo);
try {
  // Use EVM
} finally {
  evm.destroy();
}
```
:::

:::details[Performance issues with large operations]
**Solution**: Use batch operations and reuse EVM instances:
```typescript
// Good: Reuse instance
const evm = createEVM(blockInfo);
for (const tx of transactions) {
  evm.call(tx);
}
evm.destroy();

// Bad: Create per operation
for (const tx of transactions) {
  const evm = createEVM(blockInfo);
  evm.call(tx);
  evm.destroy();
}
```
:::

## Next Steps

<div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '1rem', marginTop: '2rem' }}>
  <a href="/sdks/typescript" style={{
    display: 'block',
    padding: '1.5rem',
    background: 'linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.05))',
    border: '1px solid rgba(59, 130, 246, 0.3)',
    borderRadius: '12px',
    textDecoration: 'none'
  }}>
    <h3 style={{ margin: '0 0 0.5rem 0' }}>📘 TypeScript SDK</h3>
    <p style={{ margin: 0, color: 'var(--vocs-color_text2)' }}>
      WebAssembly-based TypeScript bindings
    </p>
  </a>
  
  <a href="/sdks/swift" style={{
    display: 'block',
    padding: '1.5rem',
    background: 'linear-gradient(135deg, rgba(234, 88, 12, 0.1), rgba(220, 38, 38, 0.05))',
    border: '1px solid rgba(234, 88, 12, 0.3)',
    borderRadius: '12px',
    textDecoration: 'none'
  }}>
    <h3 style={{ margin: '0 0 0.5rem 0' }}>🍎 Swift SDK</h3>
    <p style={{ margin: 0, color: 'var(--vocs-color_text2)' }}>
      Native Swift bindings for Apple platforms
    </p>
  </a>
</div>

## Support

<Callout type="info">
  **Need help?**
  - 📖 Browse [examples](https://github.com/evmts/Guillotine/tree/main/sdks/bun/examples)
  - 💬 Join our [Telegram community](https://t.me/+ANThR9bHDLAwMjUx)
  - 🐛 Report [issues on GitHub](https://github.com/evmts/Guillotine/issues)
</Callout>